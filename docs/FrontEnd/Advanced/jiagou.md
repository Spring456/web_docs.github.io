## 简单聊聊前端架构


### 技术选型

技术选型或许是大家最熟悉也最容易开始工作的部分。

你喜欢angular、react、vue还是其他框架？路由库、网络请求库、数据层用什么工具管理？使用或是定制化哪一套UI库？

你会使用less、sass还是postcss？是否需要为多语言和换肤功能引入额外的工具？

你和你的小伙伴是否是ts铁粉？项目中是否需要引入wasm？兼容性预期是什么，应该如何配置babel、是否需要引入特定的polyfill？

你将面对的是一个PC网站的开发，移动web应用，或是一个electron桌面项目？响应式和自适应如何选择？如果你开发的是小程序，你会选择taro、uniapp/mpvue或是选择不使用这些工具？

你的应用是否需要与APP整合？直接使用webview还是选择使用cordova？如果你开发的是一个跨平台APP，你将选择RN、weex还是flutter？如果是一个web应用，是否需要通过PWA来支持离线使用？

技术选型只是第一步。请切记，我们需要考虑的不仅仅是技术本身的优劣（很多时候不同技术本身就难以分出胜负），你还要考虑你和你的团队对于技术的熟悉程度和学习成本，并带领他们掌握你所选择的技术栈。

### 代码规范

你需要制定一系列规则来使团队的代码风格尽可能一致，当面对大型和长期维护的项目时，这点往往比想象得重要。

你可能需要借助一些工具，例如jslint、tslint、csslint、prettier等等。你还需要考虑使用BME命名、OOCSS、scoped css、css in js还是其他什么方法来避免CSS冲突。

当然这只是问题的一部分，还有许多问题或许无法通过工具来限制。例如，对于数组命名，使用arr、list还是复数单词（sheep这样的单词是否会让人感到困扰？）？文件目录如何组织？点击事件是否统一以on开头？

作为架构师或是Team Leader，你需要保持定期code review的习惯来保证团队正在以好的习惯书写代码。

以及，你是否需要统一团队的工具配置，例如IDE配置、git配置（例如使用LF还是CRLF作为换行符）、是否需要使用nrm来管理npm源并使用nvm来确保统一的node/npm版本？

### UI规范

除了代码规范之外，如果有机会和设计师一起来制定一系列UI/UX规范，这会令你的项目长期受益。

确定主题与配色，typography（排印）规范（包括字体、字号、行高）。

你还要与设计师一通设计一套常用的组件以及交互方式，以确保你的界面在设计上遵循亲密性、对比、对其、重复的规则（《写给大家看的设计书》），同时给用户带来及时、一致、可控可预期的交互体验，例如”确定“统一使用绿色按钮，”取消“统一使用灰色按钮并在弹窗的左侧，蓝色文字代表连接与跳转，”删除“按钮使用红色并且每次点击会弹出二次确认框。

品质，来源于对细枝末节的把控。

### 公共代码

你需要管理你的公共代码，无论是UI组件还是非UI功能。

即使是只考虑单独的项目，也应该将具有复用可能意义的代码放到单独的目录下管理。

为了使用公共代码库，你需要搭建私有npm仓库，还是使用git submodule的形式？你的库是针对web还是nodejs设计的，对于web，你将通过webpack还是cdn的形式引入代码？如果不同形式都需要兼容，那以下形式的代码你应当非常熟悉了：

```
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
  typeof define === 'function' && define.amd ? define(factory) :
  (global = global || self, global.VueRouter = factory());
}(this, function () {
  //
}));
```

### 文档

正如之前所言，你需要带领你的团队掌握新技术并高效高质量的开发项目，并提炼可复用的代码与组件，许多内容都需要文档化。

对于非UI组件，JSDoc是一个不错的文档工具。对于UI组件，storybook绝对是一个神奇，你可以通过它创建一系列可展示、可交互的组件示例，并且让其他人可以直接拷贝实例代码。

对于非来源于代码的文档，你可能需要借助静态网站生成器（static site generator）或是博客工具来书写文档，vuepress、wordpress、conflurence、石墨文档等等都是不错的选择。

为你的团队提供可参考的代码模板是个好主意，对此你可以使用例如hygen（jondot/hygen）这样的工具。当我需要添加一个列表页面时，我会用模板生成初始代码，其中包含了分页加载、弹窗交互、筛选查询等等代码的模板，保证我添加的页面有一致的代码风格和交互行为。

### 分支管理

你需要为团队设立一套分支管理规范，如果对此你还不了解，搜索”gitflow“你可以找到需要有用的资料。

除此之外，是否所有提交到主分支的代码合并都需要提交pull request并通过code review？如何与CI/CD流程整合？commit message和提交频率是否要加以规范？merge还是rebase？

### 演进能力

对于架构而言，演进能力同样重要。将webpack从3.x升级到4.x，将vue从2.x升级到3.x，或许每次升级都会成为阵痛，但我们不能停滞不前，否则项目会慢慢变成一个难以维护的老顽固。

好在微前端理念能帮助我们处理升级和重构所带来的麻烦。single-spa是目前最流行的微前端框架之一，qiankun（umijs/qiankun）在其之上为多项目结构提供了可行的实施方案。

通过微前端架构，我们可以逐步替代项目中的代码，引入最近的技术，而不必因为畏惧而停滞不前，或是每次都翻江倒海一翻。

### 自动化：部署 & 测试

作为架构师，你需要认真了解你所使用/搭建的脚手架和webpack，熟悉每一项配置（module、optimization、plugins...）的意义与使用。
除此之外，你需要了解git hooks、docker，懂一些shell script，以便和运维团队一起整合CI/CD流程。

你需要通过自动化测试以及代码覆盖率检测来保证项目稳定前进，并制定合适的适应度函数来观察项目的健康程度。可选的工具包括jest、instanbul等等，如果你需要编写e2e测试，那你可能还需要熟悉headless chrome。

如果你决定添加自动化测试，或是遵循TDD/BDD的开发理念，这很好，不过请做好准备，这可是一项会持续牵扯团队开发经历的大工程。

### 大前端

从更大的视野来看，你可能还需要了解许多其他的内容：

BFF（Backend for Frontend）、SSR（服务端渲染）、nodejs、graphql、grpc、消息队列（mq）、授权与认证（oauth/JTW...）、nginx、数据库（SQL、mongoDB、redis、elastic search、TiDB/cockroachDB、TSDB、graphDB...）、日志管理、docker & k8s、微服务、service mesh（istio...）、serverless...

以上内容来自掘金，作者：笨笨小撒，链接：https://juejin.cn/post/6844904054896721934

### 写作最后

前端架构的理解-前端考虑的问题更多是如何实现高内聚低耦合的分层设计，架构即设计。

在实际工作中，还需要考虑到这几点，

页面之间的耦合性问题。有的页面的入口较多，同时这个页面又充当添加和编辑的功能，如果只使用一个页面来实现这些功能，需要做好注释；
这对于临时接手的小伙伴来说更方便看懂代码逻辑

组件封装的问题。如果使用了UI框架，那就尽量使用UI框架来实现页面结构，大多应该能满足基本需求。因此可以不需要再手动进行组件封装；在复杂业务时，如果页面内容并不会多处调用，因此也大可不必使用组件封装的方式，页面上组件并不是越多越好，组件太细小，使用起来并不方便，还是要依照业务来进行是否需要组件封装。







